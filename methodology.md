# Методология "Системы покупки билетов"
## Контекст
Появилась новая система СПБ" и требуется для заказчика определить ее максимальную производительность.
## Цели
1. Определение максимальной производительновсти
   1. Проведение теста максимальной производительности
   2. Подтвердить уровень нагрузки на нагрузочном тесте
## Ограничения и риски
### Риски

| № | Наименование                         | Вероятность | Результат                | Решение                               |
|---|--------------------------------------|-------------|--------------------------|---------------------------------------|
| 1 | Большой процент ошибок под нагрузкой | низкая      | Тестирование не возможно | Система потребует доработки до тестов |
|   |                                      |             |                          |                                       |
|   |                                      |             |                          |                                       |
|   |                                      |             |                          |                                       |

### Ограничение

| № | Наименование                               | Суть ограничения                                                                                                  | Решение                                |
|---|--------------------------------------------|-------------------------------------------------------------------------------------------------------------------|----------------------------------------|
| 1 | Тестовый стенд отличается от продуктивного | Результаты тестирования могут отличаться от фактических. Дефекты могут быть не актуальными для продуктивной среды | Актуализировать стенд до промышленного |
|   |                                            |                                                                                                                   |                                        |

### Целевая система (Продуктивная среда)
#### Архитектурная схема:
Входящие точки для пользователя выделены синем.
Формируемые артефакты выделены красным.

![](/Users/skyter/Downloads/Стэнд для обучения.drawio.png)
#### Конфигурация серверов

| Сервер | Контур | CPU | RAM | DISK |
|--------|--------|-----|-----|------|
|        |        |     |     |      |
|        |        |     |     |      |

#### Средства мониторинга
Соответствует тестовой.
Поскольку система выходит в продуктивную среду, то средства мониторинга тестовой среды будут использоваться в продуктиве.


## Стратегия тестирования

### Сбор профиля

Предоставленные данные от аналитиков.
Подробности см. модели тестирования профиль P0.

### Подготовка тестовых данных

Места ($.tickets.*.seat.place) извлекаем каждый раз.

### Способы достижения целей

1) Проведен тест макс-капасити и подтверждаем результат с помощью нагрузочного теста (load test).
2) Определена максимальная ступень на которой система держит нагрузку

#### Критерии для системы

1) Система соответствует требованиям, если:
   1) Процент реджектов меньше 10% (не дошедших до конца)
   2) Утилизация ресурсов ЦПУ меньше 60
   3) Ram не более 60%
   4) Времена отклика транзакции не выше 15 секунд
#### Метрики
1) transaction_success
2) transactions_rejects (prometheus actuator TicketTransactionService)
2) cpu_utilization (node_exporter)
3) memory_usage (node_exporter)
4) transaction_response_time (TicketTransactionService)
5) repsponse_time_jmeter (диф sql)
#### Тестовый стенд
##### Архитектура (конфигурационня схема)
##### Конфигурация серверов


| Сервер | Контур | CPU | RAM | DISK |
|--------|--------|-----|-----|------|
|        |        |     |     |      |
|        |        |     |     |      |

##### Средства мониторинга

| Наименование средства | сервер | цель                                | Настройки              |
|-----------------------|--------|-------------------------------------|------------------------|
| Prometheus            | 1      | Сбор и хранение метрик              | Данные хранятся 7 дней |
| Grafana               | 1      | Визуализация метрик ввиде дашбордов |                        |
| Node_exporter         | 1      |                                     |                        |
|                       |        |                                     |                        |
|                       |        |                                     |                        |


## Модель тестирования

### Бизнес процессы

| № | Наименование       | Описание                             | Ссылка |
|---|--------------------|--------------------------------------|--------|
| 1 | create_transaction | Создание траназакции покупки билетов |        |
|   |                    |                                      |        |


### Профиль

Профиль P0
| № БП | наименование       | Вариант наполнения | Базовый уровень | % от общего профиля |
|------|--------------------|--------------------|-----------------|---------------------|
| 1    | create_transaction | 1 билет            | 2               | 80%                 |
| 1    | create_transaction | 2 билета           | 0.4             | 16%                 |
| 1    | create_transaction | 3 билета           | 0.1             | 4%                  |

### Сценарий нагрузочного тестирования

Уровень нагрузки L0 как базовый уровень в профиле P0.

#### Сценарий S0
Сценарий S0 представляет из себя профиль P0 со ступенями.

| № ступени | Профиль | Ступень | Длительность, мин | RampUp, с |
|-----------|---------|---------|-------------------|-----------|
| 1         | P0      | L0      | 5                 | 30        |
| 2         | P0      | 2 x L0  | 5                 | 30        |
| 3         | P0      | 3 x L0  | 5                 | 30        |
| 4         | P0      | 4 x L0  | 5                 | 30        |

#### Сценарий S1

S1 - load test с уровнем нагрузки в 0.8 от максимальной ступени достигнутой в S0.

## Формируемые артефакты

1) БД театра, таблица purchase. Соответствие по event (title), seat ($.tickets.*.seat.place)

## Процесс

### Метрики процесса
1) Воспроизводимость
   a. как померим
2) Длительность
   а. как померим
### Вехи
#### Тесты длятся меньше 30 минут и валидны 95
првоерка вехи: 2024-09-10 - 2024-10-10
#### Статистка
###Шаги
